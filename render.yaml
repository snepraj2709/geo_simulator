services:
  # ---------------------------------------------------
  # Web Service: Main API
  # ---------------------------------------------------
  - type: web
    name: llm-brand-monitor-api
    runtime: docker
    repo: https://github.com/snepraj2709/geo_simulator # Update with your actual repo URL
    plan: starter
    region: oregon # Choose your region
    dockerContext: .
    dockerfilePath: ./Dockerfile
    target: api
    envVars:
      - key: APP_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: llm-brand-monitor-postgres
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString
      - key: NEO4J_URI
        value: bolt://llm-brand-monitor-neo4j:7687
      - key: NEO4J_USER
        value: neo4j
      - key: NEO4J_PASSWORD
        sync: false
      - key: ELASTICSEARCH_URL
        value: http://llm-brand-monitor-elasticsearch:9200
      - key: S3_ENDPOINT_URL
        value: http://llm-brand-monitor-minio:9000
      - key: CELERY_BROKER_URL
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString
      - key: CELERY_RESULT_BACKEND
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString
      - key: PYTHON_VERSION
        value: 3.11.0

  # ---------------------------------------------------
  # Worker Service: Celery Worker
  # ---------------------------------------------------
  - type: worker
    name: llm-brand-monitor-worker
    runtime: docker
    dockerContext: .
    dockerfilePath: ./Dockerfile
    target: worker
    envVars:
      - key: APP_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: llm-brand-monitor-postgres
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString
      - key: NEO4J_URI
        value: bolt://llm-brand-monitor-neo4j:7687
      - key: NEO4J_USER
        value: neo4j
      - key: NEO4J_PASSWORD
        sync: false
      - key: ELASTICSEARCH_URL
        value: http://llm-brand-monitor-elasticsearch:9200
      - key: S3_ENDPOINT_URL
        value: http://llm-brand-monitor-minio:9000
      - key: CELERY_BROKER_URL
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString
      - key: CELERY_RESULT_BACKEND
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString

  # ---------------------------------------------------
  # Worker Service: Celery Beat (Scheduler)
  # ---------------------------------------------------
  - type: worker
    name: llm-brand-monitor-beat
    runtime: docker
    dockerContext: .
    dockerfilePath: ./Dockerfile
    target: beat
    envVars:
      - key: APP_ENV
        value: production
      - key: CELERY_BROKER_URL
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString
      - key: CELERY_RESULT_BACKEND
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString

  # ---------------------------------------------------
  # Web Service: Flower (Celery Monitor)
  # ---------------------------------------------------
  - type: web
    name: llm-brand-monitor-flower
    runtime: docker
    dockerContext: .
    dockerfilePath: ./Dockerfile
    target: flower
    envVars:
      - key: CELERY_BROKER_URL
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString
      - key: CELERY_RESULT_BACKEND
        fromService:
          type: redis
          name: llm-brand-monitor-redis
          property: connectionString

  # ---------------------------------------------------
  # Private Service: Neo4j
  # ---------------------------------------------------
  - type: pserv
    name: llm-brand-monitor-neo4j
    image: neo4j:5-community
    envVars:
      - key: NEO4J_AUTH
        value: neo4j/password # Change this in production!
      - key: NEO4J_PLUGINS
        value: '["apoc"]'
    disk:
      name: neo4j-data
      mountPath: /data
      sizeGB: 10

  # ---------------------------------------------------
  # Private Service: Elasticsearch
  # ---------------------------------------------------
  - type: pserv
    name: llm-brand-monitor-elasticsearch
    image: docker.elastic.co/elasticsearch/elasticsearch:8.12.0
    envVars:
      - key: discovery.type
        value: single-node
      - key: xpack.security.enabled
        value: "false"
      - key: ES_JAVA_OPTS
        value: "-Xms512m -Xmx512m"
    disk:
      name: elasticsearch-data
      mountPath: /usr/share/elasticsearch/data
      sizeGB: 10

  # ---------------------------------------------------
  # Private Service: Minio (Object Storage)
  # ---------------------------------------------------
  - type: pserv
    name: llm-brand-monitor-minio
    image: minio/minio:latest
    startCommand: server /data --console-address ":9001"
    envVars:
      - key: MINIO_ROOT_USER
        value: minioadmin # Change this!
      - key: MINIO_ROOT_PASSWORD
        value: minioadmin # Change this!
    disk:
      name: minio-data
      mountPath: /data
      sizeGB: 10

databases:
  - name: llm-brand-monitor-postgres
    databaseName: llm_brand_monitor
    user: postgres
    plan: starter

  - name: llm-brand-monitor-redis
    plan: starter
